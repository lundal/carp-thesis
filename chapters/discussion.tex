\TODO
How it was to implement a CA system inside an FPGA.
Distributed and local communication allows it to fills entire FPGA.
Perfect for 2D structure, extra routing challenges with 3D.

\begin{itemize}
    \item Compromise between generics and custom types (VHDL-2008 not supported)
\end{itemize}

\TODO
Many resources left.
Scaling restricted by routing; almost all paths are critical.
CA shift registers are spread over whole FPGA.
It is summed into one bram (livecount).
Then spread all over, since DFT uses nearly all DSP slices.

\section{Resource Usage}

With a complete rewrite, it is interesting to see the differences in resource usage between equivalent setups.
Due to architectural differences, the performance of the new design can not be perfectly matched with that of the previous, but it should be close enough to determine the general trend.

The most closely matching configuration is:
[LUT Configuration Bits] maximized to 2 in 2D and 8 in 3D,
[Rules Tested In Parallel] set to 2,
[Type Bits] set to 5,
[State Bits] set to 1,
[Fitness] set to Live Count
and buffer sizes set to 256.
Other parameters do not significantly influence resource usage, functionality or performance.

In 3D, the live counter is four times faster, configuration is half as fast, and readback is an eight as fast.
In 2D, configuation is a quarter as fast for 32x32 matrices.
Due to different scaling in the old 2D design, no other matrix sizes have equivalent performance and have therefore been left out of the comparison.
The results are presented in \tablename~\ref{tab:resource-usage}.

\begin{table}[!ht]
    \renewcommand{\arraystretch}{1.4}
    \centering
    \begin{tabular}{c|c|c|c|c|c|c|c|c}
        \bfseries Matrix & \multicolumn{2}{c|}{\bfseries SRL16} & \multicolumn{2}{c|}{\bfseries LUTs} & \multicolumn{2}{c|}{\bfseries Registers} & \multicolumn{2}{c}{\bfseries BRAMs} \\
        \bfseries (XxYxZ) & \bfseries Total & \bfseries \% & \bfseries Old & \bfseries New & \bfseries Old & \bfseries New & \bfseries Old & \bfseries New \\
        \hline
        32x32 & 2048 & 32.0 & 14858 & 11277 & 16259 & 7043 & 38 & 53 \\
        8x8x4 & 2048 & 32.0 & 6529 & 6265 & 6011 & 4495 & 55 & 47 \\
        8x8x8 & 4096 & 63.9 & 7668 & 8374 & 5726 & 4913 & 50 & 47 \\
        8x16x4 & 4096 & 63.9 & 8234 & 8252 & 6531 & 4957 & 50 & 47 \\
        10x10x8 & 6400 & 99.9 & – & 11313 & – & 5832 & – & 52 \\
    \end{tabular}
    \caption[Resource usage]{
        Resource usage without DFT compared to the old design with most equivalently configured setup and performance.
        The old numbers are from \cite{stovneng2014sblock}.
    }
    \label{tab:resource-usage}
\end{table}

The new design appears to be slightly more efficient in 3D.
It uses about the same amount of LUTs, but substantially fewer registers and slightly fewer BRAMs.
This is a bit surprising considering the four times larger adder tree.
In 2D, both LUT and register usage are drastically reduced.

The size of the matrix is limited by the number of available 16-bit shift registers (SRL16s), as each sblock uses 2 in 2D and 8 in 3D.
Since the new design is more finely tunable, larger matrices can be fitted onto the chip.
A 10x10x8 matrix design uses 99.9\% of the 6408 shift registers on the Spartan-6 LX45T, and has been successfully implemented and tested with the above configuration.
It will even implement with [Rules Tested In Parallel] increased to 6 and [Fitness] set to DFT.
At this point, routing becomes the main problem, as there are still many logic resources left.

\section{Challenges}
\label{sec:challenges}

\TODO

\section{Future work}

\TODO

Further parameterization:
Could parameterize number of rows accessed in Cell Storage to allow higher config and readback speeds.
Make Live Counter easily replaceable (step function module)(like fitness module, improves flexibility), and allow it to use more cycles (reduces LUT usage).
Also live counter to use more cycles but reduce LUT usage.
However, LUT and register usage are not issues for 3D; routing and available shift registers are.
Shift registers set max number of cells.
Routing limits livecounter + rule testers.
In 2D, LUTs and like routing are the major issues.

\begin{itemize}
    \item Hazard detection unit so multiple modules can run simultaneously
    \item DMA-based communication interface (better speed, requires driver, more advanced com module)
    \item Watchdog-timer/Stall-prevention
\end{itemize}

\section{Warnings}

\begin{itemize}
    \item Most are due to parameterization
    \item Many from generated PCIE core
    \item Nearly all filtered to make output more readable and make it easier to find bugs
    \item Could not remove remaining due to limited filter system (don't want to cause trouble later)
    \item 728 in ISE (684 filtered)
    \item 502 in XST (457 filtered)
    \item (3D)
    \item Why the difference?
    \item Also filtered "equivalent register removal" infos to reduce clutter
\end{itemize}
